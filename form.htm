<html>
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" />
<style>
    p {
        margin-bottom: 20px;
    }
    h2 {
        margin-bottom: 20px;
    }
    button {
        font-family: Consolas, monospace;
        color: #222;
        background-color: #5bc0de;
    }
    body {
        margin: 20px;
    }
</style>

<script>
function printDeploymentId() {
    var request = new XMLHttpRequest();
    request.open('GET', '/api/deployment', true);
    request.setRequestHeader(
        'Accept', 'application/json'
    );
    request.onload = function() {
        if (request.status >= 200 && request.status < 400) {
            var body = request.responseText;
            console.log('Response: ' + request.status + ' ' + request.statusText);
            console.log('Body: ' + body);
            var commitid = document.getElementById('commitid');
            commitid.innerHTML = 'Deployment Id: ' + body;
        }
        else {
            console.error('error ' + request.status);
        }
    };
    request.onerror = function(err) {
       console.error(err);
    };
    request.send();
}

function post() {
    var request = new XMLHttpRequest();
    var gifurl = document.getElementById('gifurl').value;
    var text = document.getElementById('text').value;
    console.log('POST ' + gifurl + ' ' + text);
    request.open('POST', '/', true);
    request.setRequestHeader(
            'Content-type', 'application/x-www-form-urlencoded'
    );
    request.onload = function() {
        if (request.status >= 200 && request.status < 400) {
            // Success!
            var resp = request.responseText;
            console.log('Response: ' + request.status +
                        ' ' + request.statusText);
            console.dir('Location: ' + request.getResponseHeader('Location'));
        }
        else {
            console.error('error ' + request.status);
        }
    };
    request.onerror = function(err) {
       console.error(err);
    };
    request.send('gifurl=' + gifurl + '&text=' + text);
}


printDeploymentId();
</script>

</head>

<body>

    <code>
        Source here -- <a href="https://github.com/snobu/gifinator" title="GitHub">https://github.com/snobu/gifinator</a> -- Contributions welcome!
    </code>
    <br>
    <code id="commitid">
      <!-- commit id -->
    </code>

    <div class="container">

      <form id="form" class="form-signin" action="#" method="POST">
        <h2 class="form-signin-heading">Write on animated GIFs</h2>
        <p>Need some inspiration? - <a href="http://giphy.com/" title="Giphy" target="_blank">http://giphy.com</a> (Right click on gifs -> Copy image address)<br>imgur.com is fine too, we detect image ID from stuff like imgur.com/BlaHbLAh and fetch the .gif</p>
        <p>
          <label for="gifurl" class="sr-only">.gif URL</label>
          <input type="text" id="gifurl" name="gifurl" class="form-control" placeholder=".gif URL" required autofocus>
        </p>
        <p>
          <label for="text" class="sr-only">Annotate with text</label>
          <input type="text" id="text" name="text" class="form-control" placeholder="Annotate with text" required>
        </p>
        <p>
          <button class="btn btn-lg btn-block" id="go" type="submit" onClick="post()">Make GIF</button>
        <p>
    </form>

    </div> <!-- /container -->

    <div style="margin-top: 120px">
      <center>
        <p>Running on Azure App Service in a Linux worker</p>
        <img src="https://azure.microsoft.com/svghandler/app-service/?width=60" />
      </center>
    </div>

</body>
</html>
